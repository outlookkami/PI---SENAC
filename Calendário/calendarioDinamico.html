<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- CSS for full calender -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" rel="stylesheet" />
<!-- JS for jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- JS for full calender -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
<!-- bootstrap css and js -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<body>
    <div id="calendar"></div>

    <div class="CriarEventoForm modal fade" id="formCriarEvento" tabindex="-1" role="dialog">
        <form method="post" class="CriarEventoForm"></form>
        <h2 class="CNE">Criar Novo Evento</h2><br>
        <label for="titulo_evento"><b>Título do evento</b></label><br>
        <input class="inpt1" type="text" name="titulo_evento" id="titulo_evento" placeholder="Digite o título do seu evento">
        <br><br>
        <label for="descricao_evento"><b>Descrição</b></label><br>
        <input class="inpt1" type="text" name="descricao_evento" id="descricao_evento" placeholder="Descreva o evento">
        <br><br>
        <label for="data_evento"><b>Data</b></label><br>
        <input class="inpt1" type="date" name="data_evento" id="data_evento" >
        <br><br>
        <label for="horario_evento"><b>Horário</b></label><br>
        <input class="inpt1" type="text" name="horario_evento" id="horario_evento" placeholder="Ex: 14:00 - 16:00">
        <br><br>
        <label for="local_evento"><b>Local</b></label><br>
        <input class="inpt1" type="text" name="local_evento" id="local_evento" placeholder="Digite o local do evento">
        <br><br>
        <label for="categoria_evento"><b>Categoria</b></label><br>
            <select name="seleciona_tipo_evento" id="categoria_evento">
                <option value="seleção" disabled selected>Selecione uma opção</option>
                <option value="Reunião">Reunião</option>
                <option value="Workshop">Workshop</option>
                <option value="Festa">Festa</option>
                <option value="Palestra">Palestra</option>
                <option value="Outros">Outros</option>
            </select>
        <br><br>
        <label for="botaoArquivos"><b>Arquivo de imagem (opcional)</b></label><br>
        <input class="file" type="file" id="botaoArquivos">
        <label for="botaoArquivos" class="estiloFile">Escolher arquivo</label>
        <br><br>
        <button class="botaoCancelar" onclick="escondeForm()">Cancelar</button>
        <button class="botaoCriar" type="submit" onclick="escondeForm()">Criar Evento</button>
    </div>

<script>
$(document).ready(function() {
	display_events();
}); //end document.ready block

function display_events() {
	var events = new Array();
$.ajax({
    url: 'displayCalendario.php',  
    dataType: 'json',
    success: function (response) {
         
    var result=response.data;
    $.each(result, function (i, item) {
    	events.push({
            event_id: result[i].event_id,
            title: result[i].title,
            start: result[i].start,
            end: result[i].end,
            color: result[i].color,
            url: result[i].url
        }); 	
    })
	var calendar = $('#calendar').fullCalendar({
	    defaultView: 'month',
		 timeZone: 'local',
	    editable: true,
        selectable: true,
		selectHelper: true,
        select: function(start, end) {
				alert(start);
				alert(end);
				$('#event_start_date').val(moment(start).format('YYYY-MM-DD'));
				$('#event_end_date').val(moment(end).format('YYYY-MM-DD'));
				$('#event_entry_modal').modal('show');
			},
        events: events,
	    eventRender: function(event, element, view) { 
            element.bind('click', function() {
					alert(event.event_id);
				});
    	}
		}); //end fullCalendar block	
	  },//end success block
	  error: function (xhr, status) {
	//   alert(response.msg);
	  }
	});//end ajax block	
}

function save_event()
{
var titulo_evento=$("#titulo_evento").val();
var event_start_date=$("#event_start_date").val();
var event_end_date=$("#event_end_date").val();
if(titulo_evento=="" || event_start_date=="" || event_end_date=="")
{
alert("Por favor preencha todos os campos.");
return false;
}
$.ajax({
 url:"save_event.php",
 type:"POST",
 dataType: 'json',
 data: {titulo_evento:titulo_evento,event_start_date:event_start_date,event_end_date:event_end_date},
 success:function(response){
   $('#event_entry_modal').modal('hide');  
   if(response.status == true)
   {
	alert(response.msg);
	location.reload();
   }
   else
   {
	 alert(response.msg);
   }
  },
  error: function (xhr, status) {
  console.log('ajax error = ' + xhr.statusText);
  alert(response.msg);
  }
});    
return false;
}
</script>
</body>
</html>